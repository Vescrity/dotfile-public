#!/bin/bash
export DISPLAY="${1:-:1}"
Xwayland $DISPLAY > /dev/null 2>&1 &
XDG_SESSION_TYPE=x11
unset WAYLAND_DISPLAY
wait_time=0.1

while true; do
#    if xset q > /dev/null 2>&1; then
    if xdpyinfo > /dev/null 2>&1; then
        echo "X11 server is available."
        break
    else
        echo "Trying to connect to X11 server... (waiting for $wait_time seconds)"
        sleep $wait_time
        wait_time=$(echo "$wait_time * 2" | bc)
    fi
done

export GTK_IM_MODULE=fcitx
export XMODIFIERS=@im=fcitx
export QT_IM_MODULE=fcitx
export SDL_IM_MODULE=fcitx
export GLFW_IM_MODULE=ibus

i3 -c ~/.config/i3/nest.cfg
#xfwm4
