#!/bin/bash

#swpid=$(pidof swww-daemon)
swpid=$(pidof swaybg)
#if [ -z "$swpid" ]; then
#    swww-daemon &
#    exit
#fi

WALLPAPER_DIR=~/Pictures/Wallpaper
WALLPAPER_INDEX=~/Pictures/Wallpaper/.wallpaper_index
if [ -f "$WALLPAPER_INDEX" ]; then
    index=$(cat "$WALLPAPER_INDEX")
else
    index=0
fi
FILES=($WALLPAPER_DIR/*.{png,jpg,jxl})
TOTAL=${#FILES[@]}
if [ -z "$swpid" ]; then
    true
else 
    if [ -z "$1" ]; then
        ((index++))
    else
        ((index--))
    fi
fi
# 确保索引不会超出范围
if [[ "$index" -ge "$TOTAL" ]]; then
    index=0
elif [[ "$index" -lt 0 ]]; then
    index=$((TOTAL-1))
fi
echo "$index" > "$WALLPAPER_INDEX"
#hyprctl hyprpaper preload "${FILES[$index]}"
#hyprctl hyprpaper wallpaper "eDP-1,${FILES[$index]}"
#swww img "${FILES[$index]}" --transition-type outer --transition-bezier '0.10,0.6,0.15,1.1' --transition-fps 60 --transition-pos 0.1,0.9
#swww img "${FILES[$index]}" 
swaybg -m fill -i "${FILES[$index]}" &
if [ -z "$swpid" ]; then
    exit
fi
kill $swpid
