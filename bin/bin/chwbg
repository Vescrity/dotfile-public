#!/bin/bash

swpid=$(pidof swww-daemon)
if [ -z "$swpid" ]; then
    swww-daemon &
    exit
fi

WALLPAPER_DIR=~/Pictures/Wallpaper
WALLPAPER_INDEX=~/Pictures/Wallpaper/.wallpaper_index
if [ -f "$WALLPAPER_INDEX" ]; then
    index=$(cat "$WALLPAPER_INDEX")
else
    index=0
fi
FILES=($WALLPAPER_DIR/*.{png,jpg,webp})
TOTAL=${#FILES[@]}
if [ -z "$1" ]; then
    ((index++))
else
    ((index--))
fi
# 确保索引不会超出范围
if [[ "$index" -ge "$TOTAL" ]]; then
    index=0
elif [[ "$index" -lt 0 ]]; then
    index=$((TOTAL-1))
fi
#hyprctl hyprpaper preload "${FILES[$index]}"
#hyprctl hyprpaper wallpaper "eDP-1,${FILES[$index]}"
#swww img "${FILES[$index]}" --transition-type outer --transition-bezier '0.10,0.6,0.15,1.1' --transition-fps 60 --transition-pos 0.1,0.9
swww img "${FILES[$index]}" 
echo "$index" > "$WALLPAPER_INDEX"
